{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _objectWithoutProperties = require(\"@babel/runtime/helpers/objectWithoutProperties\");\nvar _excluded = [\"com.apple.developer.associated-domains\"];\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getEntitlementsPath = getEntitlementsPath;\nexports.setAssociatedDomains = setAssociatedDomains;\nexports.withAssociatedDomains = void 0;\nfunction _fs() {\n  var data = _interopRequireDefault(require(\"fs\"));\n  _fs = function _fs() {\n    return data;\n  };\n  return data;\n}\nfunction _path() {\n  var data = _interopRequireDefault(require(\"path\"));\n  _path = function _path() {\n    return data;\n  };\n  return data;\n}\nfunction _slash() {\n  var data = _interopRequireDefault(require(\"slash\"));\n  _slash = function _slash() {\n    return data;\n  };\n  return data;\n}\nfunction _iosPlugins() {\n  var data = require(\"../plugins/ios-plugins\");\n  _iosPlugins = function _iosPlugins() {\n    return data;\n  };\n  return data;\n}\nfunction _fs2() {\n  var data = require(\"../utils/fs\");\n  _fs2 = function _fs2() {\n    return data;\n  };\n  return data;\n}\nfunction Paths() {\n  var data = _interopRequireWildcard(require(\"./Paths\"));\n  Paths = function Paths() {\n    return data;\n  };\n  return data;\n}\nfunction _Xcodeproj() {\n  var data = require(\"./utils/Xcodeproj\");\n  _Xcodeproj = function _Xcodeproj() {\n    return data;\n  };\n  return data;\n}\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n  var cache = _getRequireWildcardCache(nodeInterop);\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj.default = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar withAssociatedDomains = (0, _iosPlugins().createEntitlementsPlugin)(setAssociatedDomains, 'withAssociatedDomains');\nexports.withAssociatedDomains = withAssociatedDomains;\nfunction setAssociatedDomains(config, _ref) {\n  var _ = _ref['com.apple.developer.associated-domains'],\n    entitlementsPlist = _objectWithoutProperties(_ref, _excluded);\n  var _config$ios;\n  if ((_config$ios = config.ios) !== null && _config$ios !== void 0 && _config$ios.associatedDomains) {\n    return _objectSpread(_objectSpread({}, entitlementsPlist), {}, {\n      'com.apple.developer.associated-domains': config.ios.associatedDomains\n    });\n  }\n  return entitlementsPlist;\n}\nfunction getEntitlementsPath(projectRoot) {\n  var paths = Paths().getAllEntitlementsPaths(projectRoot);\n  var targetPath = null;\n  var project = (0, _Xcodeproj().getPbxproj)(projectRoot);\n  var projectName = (0, _Xcodeproj().getProjectName)(projectRoot);\n  var productName = (0, _Xcodeproj().getProductName)(project);\n  var entitlementsRelativePath = (0, _slash().default)(_path().default.join(projectName, productName + \".entitlements\"));\n  var entitlementsPath = (0, _slash().default)(_path().default.normalize(_path().default.join(projectRoot, 'ios', entitlementsRelativePath)));\n  var pathsToDelete = [];\n  while (paths.length) {\n    var last = (0, _slash().default)(_path().default.normalize(paths.pop()));\n    if (last !== entitlementsPath) {\n      pathsToDelete.push(last);\n    } else {\n      targetPath = last;\n    }\n  }\n  if (!targetPath) {\n    targetPath = entitlementsPath;\n    var template = ENTITLEMENTS_TEMPLATE;\n    if (pathsToDelete.length) {\n      var _last = pathsToDelete[pathsToDelete.length - 1];\n      template = _fs().default.readFileSync(_last, 'utf8');\n    }\n    _fs().default.mkdirSync(_path().default.dirname(entitlementsPath), {\n      recursive: true\n    });\n    _fs().default.writeFileSync(entitlementsPath, template);\n    Object.entries(project.pbxXCBuildConfigurationSection()).filter(_Xcodeproj().isNotComment).filter(_Xcodeproj().isBuildConfig).filter(_Xcodeproj().isNotTestHost).forEach(function (_ref2) {\n      var buildSettings = _ref2[1].buildSettings;\n      buildSettings.CODE_SIGN_ENTITLEMENTS = \"\\\"\" + entitlementsRelativePath + \"\\\"\";\n    });\n    _fs().default.writeFileSync(project.filepath, project.writeSync());\n  }\n  deleteEntitlementsFiles(pathsToDelete);\n  return entitlementsPath;\n}\nfunction deleteEntitlementsFiles(entitlementsPaths) {\n  for (var path of entitlementsPaths) {\n    (0, _fs2().removeFile)(path);\n  }\n}\nvar ENTITLEMENTS_TEMPLATE = \"\\n<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<!DOCTYPE plist PUBLIC \\\"-//Apple//DTD PLIST 1.0//EN\\\" \\\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\\">\\n<plist version=\\\"1.0\\\">\\n<dict>\\n</dict>\\n</plist>\\n\";","map":{"version":3,"names":["_fs","data","_interopRequireDefault","require","_path","_slash","_iosPlugins","_fs2","Paths","_interopRequireWildcard","_Xcodeproj","withAssociatedDomains","createEntitlementsPlugin","setAssociatedDomains","config","_ref","_","entitlementsPlist","_objectWithoutProperties","_excluded","_config$ios","ios","associatedDomains","_objectSpread","getEntitlementsPath","projectRoot","paths","getAllEntitlementsPaths","targetPath","project","getPbxproj","projectName","getProjectName","productName","getProductName","entitlementsRelativePath","default","join","entitlementsPath","normalize","pathsToDelete","length","last","pop","push","template","ENTITLEMENTS_TEMPLATE","readFileSync","mkdirSync","dirname","recursive","writeFileSync","Object","entries","pbxXCBuildConfigurationSection","filter","isNotComment","isBuildConfig","isNotTestHost","forEach","_ref2","buildSettings","CODE_SIGN_ENTITLEMENTS","filepath","writeSync","deleteEntitlementsFiles","entitlementsPaths","path","removeFile"],"sources":["/Users/henriqueeidt/Documents/Projects/poc-web-mobile-components/component-library/node_modules/@expo/config-plugins/src/ios/Entitlements.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config-types';\nimport { JSONObject } from '@expo/json-file';\nimport fs from 'fs';\nimport path from 'path';\nimport slash from 'slash';\n\nimport { createEntitlementsPlugin } from '../plugins/ios-plugins';\nimport { removeFile } from '../utils/fs';\nimport * as Paths from './Paths';\nimport {\n  getPbxproj,\n  getProductName,\n  getProjectName,\n  isBuildConfig,\n  isNotComment,\n  isNotTestHost,\n} from './utils/Xcodeproj';\n\nexport const withAssociatedDomains = createEntitlementsPlugin(\n  setAssociatedDomains,\n  'withAssociatedDomains'\n);\n\nexport function setAssociatedDomains(\n  config: ExpoConfig,\n  { 'com.apple.developer.associated-domains': _, ...entitlementsPlist }: JSONObject\n): JSONObject {\n  if (config.ios?.associatedDomains) {\n    return {\n      ...entitlementsPlist,\n      'com.apple.developer.associated-domains': config.ios.associatedDomains,\n    };\n  }\n\n  return entitlementsPlist;\n}\n\nexport function getEntitlementsPath(projectRoot: string): string {\n  const paths = Paths.getAllEntitlementsPaths(projectRoot);\n  let targetPath: string | null = null;\n\n  /**\n   * Add file to pbxproj under CODE_SIGN_ENTITLEMENTS\n   */\n  const project = getPbxproj(projectRoot);\n  const projectName = getProjectName(projectRoot);\n  const productName = getProductName(project);\n\n  // Use posix formatted path, even on Windows\n  const entitlementsRelativePath = slash(path.join(projectName, `${productName}.entitlements`));\n  const entitlementsPath = slash(\n    path.normalize(path.join(projectRoot, 'ios', entitlementsRelativePath))\n  );\n\n  const pathsToDelete: string[] = [];\n\n  while (paths.length) {\n    const last = slash(path.normalize(paths.pop()!));\n    if (last !== entitlementsPath) {\n      pathsToDelete.push(last);\n    } else {\n      targetPath = last;\n    }\n  }\n\n  // Create a new entitlements file\n  if (!targetPath) {\n    targetPath = entitlementsPath;\n\n    // Use the default template\n    let template = ENTITLEMENTS_TEMPLATE;\n\n    // If an old entitlements file exists, copy it's contents into the new file.\n    if (pathsToDelete.length) {\n      // Get the last entitlements file and use it as the template\n      const last = pathsToDelete[pathsToDelete.length - 1]!;\n      template = fs.readFileSync(last, 'utf8');\n    }\n\n    fs.mkdirSync(path.dirname(entitlementsPath), { recursive: true });\n    fs.writeFileSync(entitlementsPath, template);\n\n    Object.entries(project.pbxXCBuildConfigurationSection())\n      .filter(isNotComment)\n      .filter(isBuildConfig)\n      .filter(isNotTestHost)\n      .forEach(({ 1: { buildSettings } }: any) => {\n        buildSettings.CODE_SIGN_ENTITLEMENTS = `\"${entitlementsRelativePath}\"`;\n      });\n    fs.writeFileSync(project.filepath, project.writeSync());\n  }\n\n  // Clean up others\n  deleteEntitlementsFiles(pathsToDelete);\n\n  return entitlementsPath;\n}\n\nfunction deleteEntitlementsFiles(entitlementsPaths: string[]) {\n  for (const path of entitlementsPaths) {\n    removeFile(path);\n  }\n}\n\nconst ENTITLEMENTS_TEMPLATE = `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n</dict>\n</plist>\n`;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}