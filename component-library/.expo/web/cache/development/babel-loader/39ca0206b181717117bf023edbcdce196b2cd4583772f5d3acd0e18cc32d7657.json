{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tapable_1 = require(\"tapable\");\nvar webpack_1 = require(\"webpack\");\nvar hooksMap = new WeakMap();\nfunction createWebpackPluginHooks() {\n  return {\n    beforeEmit: new tapable_1.AsyncSeriesWaterfallHook(['pluginArgs']),\n    afterEmit: new tapable_1.AsyncSeriesWaterfallHook(['pluginArgs'])\n  };\n}\nvar JsonWebpackPlugin = function () {\n  function JsonWebpackPlugin(options) {\n    var _this = this;\n    _classCallCheck(this, JsonWebpackPlugin);\n    this.options = options;\n    this.writeObject = function () {\n      var _ref = _asyncToGenerator(function* (compilation) {\n        var result = {\n          json: _this.options.json,\n          path: _this.options.path,\n          plugin: _this\n        };\n        try {\n          result = yield JsonWebpackPlugin.getHooks(compilation).beforeEmit.promise(result);\n        } catch (error) {\n          compilation.errors.push(error);\n        }\n        var json = JSON.stringify(result.json, undefined, _this.options.pretty ? 2 : undefined);\n        compilation.emitAsset(result.path, new webpack_1.sources.RawSource(json));\n        yield JsonWebpackPlugin.getHooks(compilation).afterEmit.promise({\n          json: json,\n          outputName: result.path,\n          plugin: _this\n        });\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    if (!this.options.path || !this.options.json) {\n      throw new Error('Failed to write json because either `path` or `json` were not defined.');\n    }\n  }\n  _createClass(JsonWebpackPlugin, [{\n    key: \"apply\",\n    value: function apply(compiler) {\n      var _this2 = this;\n      compiler.hooks.compilation.tap(this.constructor.name, function (compilation) {\n        compilation.hooks.processAssets.tapPromise({\n          name: _this2.constructor.name,\n          stage: webpack_1.Compilation.PROCESS_ASSETS_STAGE_ADDITIONAL\n        }, _asyncToGenerator(function* () {\n          yield _this2.writeObject(compilation);\n        }));\n      });\n    }\n  }], [{\n    key: \"getHooks\",\n    value: function getHooks(compilation) {\n      var hooks = hooksMap.get(compilation);\n      if (hooks === undefined) {\n        hooks = createWebpackPluginHooks();\n        hooksMap.set(compilation, hooks);\n      }\n      return hooks;\n    }\n  }]);\n  return JsonWebpackPlugin;\n}();\nexports.default = JsonWebpackPlugin;","map":{"version":3,"names":["tapable_1","require","webpack_1","hooksMap","WeakMap","createWebpackPluginHooks","beforeEmit","AsyncSeriesWaterfallHook","afterEmit","JsonWebpackPlugin","options","_this","_classCallCheck","writeObject","_ref","_asyncToGenerator","compilation","result","json","path","plugin","getHooks","promise","error","errors","push","JSON","stringify","undefined","pretty","emitAsset","sources","RawSource","outputName","_x","apply","arguments","Error","_createClass","key","value","compiler","_this2","hooks","tap","constructor","name","processAssets","tapPromise","stage","Compilation","PROCESS_ASSETS_STAGE_ADDITIONAL","get","set","exports","default"],"sources":["/Users/henriqueeidt/Documents/Projects/poc-web-mobile-components/component-library/node_modules/@expo/webpack-config/src/plugins/JsonWebpackPlugin.ts"],"sourcesContent":["import { AsyncSeriesWaterfallHook } from 'tapable';\nimport { Compilation, Compiler, sources } from 'webpack';\n\nexport type Options = {\n  path: string;\n  json: any;\n  pretty?: boolean;\n};\n\nexport type BeforeEmitOptions = Options & { plugin: JsonWebpackPlugin };\n\nexport type AfterEmitOptions = Pick<Options, 'json'> & {\n  outputName: string;\n  plugin: JsonWebpackPlugin;\n};\n\nconst hooksMap = new WeakMap<Compilation, ReturnType<typeof createWebpackPluginHooks>>();\n\nfunction createWebpackPluginHooks() {\n  return {\n    beforeEmit: new AsyncSeriesWaterfallHook<BeforeEmitOptions>(['pluginArgs']),\n    afterEmit: new AsyncSeriesWaterfallHook<AfterEmitOptions>(['pluginArgs']),\n  };\n}\n\nexport default class JsonWebpackPlugin {\n  static getHooks(compilation: Compilation) {\n    let hooks = hooksMap.get(compilation);\n    // Setup the hooks only once\n    if (hooks === undefined) {\n      hooks = createWebpackPluginHooks();\n      hooksMap.set(compilation, hooks);\n    }\n    return hooks;\n  }\n\n  constructor(public options: Options) {\n    if (!this.options.path || !this.options.json) {\n      throw new Error('Failed to write json because either `path` or `json` were not defined.');\n    }\n  }\n\n  apply(compiler: Compiler) {\n    compiler.hooks.compilation.tap(this.constructor.name, (compilation: Compilation) => {\n      compilation.hooks.processAssets.tapPromise(\n        {\n          name: this.constructor.name,\n          // https://github.com/webpack/webpack/blob/master/lib/Compilation.js#L3280\n          stage: Compilation.PROCESS_ASSETS_STAGE_ADDITIONAL,\n        },\n        async () => {\n          await this.writeObject(compilation);\n        }\n      );\n    });\n  }\n\n  private writeObject = async (compilation: Compilation): Promise<void> => {\n    let result: BeforeEmitOptions = {\n      json: this.options.json,\n      path: this.options.path,\n      plugin: this,\n    };\n    try {\n      result = await JsonWebpackPlugin.getHooks(compilation).beforeEmit.promise(result);\n    } catch (error: any) {\n      compilation.errors.push(error);\n    }\n\n    const json = JSON.stringify(result.json, undefined, this.options.pretty ? 2 : undefined);\n\n    // Once all files are added to the webpack compilation\n    // let the webpack compiler continue\n    compilation.emitAsset(result.path, new sources.RawSource(json));\n\n    await JsonWebpackPlugin.getHooks(compilation).afterEmit.promise({\n      json,\n      outputName: result.path,\n      plugin: this,\n    });\n  };\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAeA,IAAME,QAAQ,GAAG,IAAIC,OAAO,EAA4D;AAExF,SAASC,wBAAwBA,CAAA;EAC/B,OAAO;IACLC,UAAU,EAAE,IAAIN,SAAA,CAAAO,wBAAwB,CAAoB,CAAC,YAAY,CAAC,CAAC;IAC3EC,SAAS,EAAE,IAAIR,SAAA,CAAAO,wBAAwB,CAAmB,CAAC,YAAY,CAAC;GACzE;AACH;AAAC,IAEoBE,iBAAiB;EAWpC,SAAAA,kBAAmBC,OAAgB;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAH,iBAAA;IAAhB,KAAAC,OAAO,GAAPA,OAAO;IAqBlB,KAAAG,WAAW;MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAOC,WAAwB,EAAmB;QACtE,IAAIC,MAAM,GAAsB;UAC9BC,IAAI,EAAEP,KAAI,CAACD,OAAO,CAACQ,IAAI;UACvBC,IAAI,EAAER,KAAI,CAACD,OAAO,CAACS,IAAI;UACvBC,MAAM,EAAET;SACT;QACD,IAAI;UACFM,MAAM,SAASR,iBAAiB,CAACY,QAAQ,CAACL,WAAW,CAAC,CAACV,UAAU,CAACgB,OAAO,CAACL,MAAM,CAAC;SAClF,CAAC,OAAOM,KAAU,EAAE;UACnBP,WAAW,CAACQ,MAAM,CAACC,IAAI,CAACF,KAAK,CAAC;;QAGhC,IAAML,IAAI,GAAGQ,IAAI,CAACC,SAAS,CAACV,MAAM,CAACC,IAAI,EAAEU,SAAS,EAAEjB,KAAI,CAACD,OAAO,CAACmB,MAAM,GAAG,CAAC,GAAGD,SAAS,CAAC;QAIxFZ,WAAW,CAACc,SAAS,CAACb,MAAM,CAACE,IAAI,EAAE,IAAIjB,SAAA,CAAA6B,OAAO,CAACC,SAAS,CAACd,IAAI,CAAC,CAAC;QAE/D,MAAMT,iBAAiB,CAACY,QAAQ,CAACL,WAAW,CAAC,CAACR,SAAS,CAACc,OAAO,CAAC;UAC9DJ,IAAI,EAAJA,IAAI;UACJe,UAAU,EAAEhB,MAAM,CAACE,IAAI;UACvBC,MAAM,EAAET;SACT,CAAC;MACJ,CAAC;MAAA,iBAAAuB,EAAA;QAAA,OAAApB,IAAA,CAAAqB,KAAA,OAAAC,SAAA;MAAA;IAAA;IA3CC,IAAI,CAAC,IAAI,CAAC1B,OAAO,CAACS,IAAI,IAAI,CAAC,IAAI,CAACT,OAAO,CAACQ,IAAI,EAAE;MAC5C,MAAM,IAAImB,KAAK,CAAC,wEAAwE,CAAC;;EAE7F;EAACC,YAAA,CAAA7B,iBAAA;IAAA8B,GAAA;IAAAC,KAAA,EAED,SAAAL,MAAMM,QAAkB;MAAA,IAAAC,MAAA;MACtBD,QAAQ,CAACE,KAAK,CAAC3B,WAAW,CAAC4B,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,EAAE,UAAC9B,WAAwB,EAAI;QACjFA,WAAW,CAAC2B,KAAK,CAACI,aAAa,CAACC,UAAU,CACxC;UACEF,IAAI,EAAEJ,MAAI,CAACG,WAAW,CAACC,IAAI;UAE3BG,KAAK,EAAE/C,SAAA,CAAAgD,WAAW,CAACC;SACpB,EAAApC,iBAAA,CACD,aAAW;UACT,MAAM2B,MAAI,CAAC7B,WAAW,CAACG,WAAW,CAAC;QACrC,CAAC,EACF;MACH,CAAC,CAAC;IACJ;EAAC;IAAAuB,GAAA;IAAAC,KAAA,EA7BD,SAAAnB,SAAgBL,WAAwB;MACtC,IAAI2B,KAAK,GAAGxC,QAAQ,CAACiD,GAAG,CAACpC,WAAW,CAAC;MAErC,IAAI2B,KAAK,KAAKf,SAAS,EAAE;QACvBe,KAAK,GAAGtC,wBAAwB,EAAE;QAClCF,QAAQ,CAACkD,GAAG,CAACrC,WAAW,EAAE2B,KAAK,CAAC;;MAElC,OAAOA,KAAK;IACd;EAAC;EAAA,OAAAlC,iBAAA;AAAA;AATH6C,OAAA,CAAAC,OAAA,GAAA9C,iBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}