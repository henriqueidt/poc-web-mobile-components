{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLocales = getLocales;\nexports.getResolvedLocalesAsync = getResolvedLocalesAsync;\nexports.setLocalesAsync = setLocalesAsync;\nexports.withLocales = void 0;\nfunction _jsonFile() {\n  var data = _interopRequireDefault(require(\"@expo/json-file\"));\n  _jsonFile = function _jsonFile() {\n    return data;\n  };\n  return data;\n}\nfunction _fs() {\n  var data = _interopRequireDefault(require(\"fs\"));\n  _fs = function _fs() {\n    return data;\n  };\n  return data;\n}\nfunction _path() {\n  var data = require(\"path\");\n  _path = function _path() {\n    return data;\n  };\n  return data;\n}\nfunction _iosPlugins() {\n  var data = require(\"../plugins/ios-plugins\");\n  _iosPlugins = function _iosPlugins() {\n    return data;\n  };\n  return data;\n}\nfunction _warnings() {\n  var data = require(\"../utils/warnings\");\n  _warnings = function _warnings() {\n    return data;\n  };\n  return data;\n}\nfunction _Xcodeproj() {\n  var data = require(\"./utils/Xcodeproj\");\n  _Xcodeproj = function _Xcodeproj() {\n    return data;\n  };\n  return data;\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar withLocales = function withLocales(config) {\n  return (0, _iosPlugins().withXcodeProject)(config, function () {\n    var _ref = _asyncToGenerator(function* (config) {\n      config.modResults = yield setLocalesAsync(config, {\n        projectRoot: config.modRequest.projectRoot,\n        project: config.modResults\n      });\n      return config;\n    });\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n};\nexports.withLocales = withLocales;\nfunction getLocales(config) {\n  var _config$locales;\n  return (_config$locales = config.locales) !== null && _config$locales !== void 0 ? _config$locales : null;\n}\nfunction setLocalesAsync(_x2, _x3) {\n  return _setLocalesAsync.apply(this, arguments);\n}\nfunction _setLocalesAsync() {\n  _setLocalesAsync = _asyncToGenerator(function* (config, _ref2) {\n    var projectRoot = _ref2.projectRoot,\n      project = _ref2.project;\n    var locales = getLocales(config);\n    if (!locales) {\n      return project;\n    }\n    var localesMap = yield getResolvedLocalesAsync(projectRoot, locales);\n    var projectName = (0, _Xcodeproj().getProjectName)(projectRoot);\n    var supportingDirectory = (0, _path().join)(projectRoot, 'ios', projectName, 'Supporting');\n    var stringName = 'InfoPlist.strings';\n    for (var _ref3 of Object.entries(localesMap)) {\n      var _ref4 = _slicedToArray(_ref3, 2);\n      var lang = _ref4[0];\n      var localizationObj = _ref4[1];\n      var dir = (0, _path().join)(supportingDirectory, lang + \".lproj\");\n      yield _fs().default.promises.mkdir(dir, {\n        recursive: true\n      });\n      var strings = (0, _path().join)(dir, stringName);\n      var buffer = [];\n      for (var _ref5 of Object.entries(localizationObj)) {\n        var _ref6 = _slicedToArray(_ref5, 2);\n        var plistKey = _ref6[0];\n        var localVersion = _ref6[1];\n        buffer.push(plistKey + \" = \\\"\" + localVersion + \"\\\";\");\n      }\n      yield _fs().default.promises.writeFile(strings, buffer.join('\\n'));\n      var groupName = projectName + \"/Supporting/\" + lang + \".lproj\";\n      var group = (0, _Xcodeproj().ensureGroupRecursively)(project, groupName);\n      if (!(group !== null && group !== void 0 && group.children.some(function (_ref7) {\n        var comment = _ref7.comment;\n        return comment === stringName;\n      }))) {\n        project = (0, _Xcodeproj().addResourceFileToGroup)({\n          filepath: (0, _path().relative)(supportingDirectory, strings),\n          groupName: groupName,\n          project: project,\n          isBuildFile: true,\n          verbose: true\n        });\n      }\n    }\n    return project;\n  });\n  return _setLocalesAsync.apply(this, arguments);\n}\nfunction getResolvedLocalesAsync(_x4, _x5) {\n  return _getResolvedLocalesAsync.apply(this, arguments);\n}\nfunction _getResolvedLocalesAsync() {\n  _getResolvedLocalesAsync = _asyncToGenerator(function* (projectRoot, input) {\n    var locales = {};\n    for (var _ref8 of Object.entries(input)) {\n      var _ref9 = _slicedToArray(_ref8, 2);\n      var lang = _ref9[0];\n      var localeJsonPath = _ref9[1];\n      if (typeof localeJsonPath === 'string') {\n        try {\n          locales[lang] = yield _jsonFile().default.readAsync((0, _path().join)(projectRoot, localeJsonPath));\n        } catch (e) {\n          (0, _warnings().addWarningIOS)(\"locales.\" + lang, \"Failed to parse JSON of locale file for language: \" + lang, 'https://docs.expo.dev/distribution/app-stores/#localizing-your-ios-app');\n        }\n      } else {\n        locales[lang] = localeJsonPath;\n      }\n    }\n    return locales;\n  });\n  return _getResolvedLocalesAsync.apply(this, arguments);\n}","map":{"version":3,"names":["_jsonFile","data","_interopRequireDefault","require","_fs","_path","_iosPlugins","_warnings","_Xcodeproj","withLocales","config","withXcodeProject","_ref","_asyncToGenerator","modResults","setLocalesAsync","projectRoot","modRequest","project","_x","apply","arguments","getLocales","_config$locales","locales","_x2","_x3","_setLocalesAsync","_ref2","localesMap","getResolvedLocalesAsync","projectName","getProjectName","supportingDirectory","join","stringName","_ref3","Object","entries","_ref4","_slicedToArray","lang","localizationObj","dir","default","promises","mkdir","recursive","strings","buffer","_ref5","_ref6","plistKey","localVersion","push","writeFile","groupName","group","ensureGroupRecursively","children","some","_ref7","comment","addResourceFileToGroup","filepath","relative","isBuildFile","verbose","_x4","_x5","_getResolvedLocalesAsync","input","_ref8","_ref9","localeJsonPath","readAsync","e","addWarningIOS"],"sources":["/Users/henriqueeidt/Documents/Projects/poc-web-mobile-components/component-library/node_modules/@expo/config-plugins/src/ios/Locales.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config-types';\nimport JsonFile from '@expo/json-file';\nimport fs from 'fs';\nimport { join, relative } from 'path';\nimport { XcodeProject } from 'xcode';\n\nimport { ConfigPlugin } from '../Plugin.types';\nimport { withXcodeProject } from '../plugins/ios-plugins';\nimport { addWarningIOS } from '../utils/warnings';\nimport { addResourceFileToGroup, ensureGroupRecursively, getProjectName } from './utils/Xcodeproj';\n\ntype LocaleJson = Record<string, string>;\ntype ResolvedLocalesJson = Record<string, LocaleJson>;\ntype ExpoConfigLocales = NonNullable<ExpoConfig['locales']>;\n\nexport const withLocales: ConfigPlugin = config => {\n  return withXcodeProject(config, async config => {\n    config.modResults = await setLocalesAsync(config, {\n      projectRoot: config.modRequest.projectRoot,\n      project: config.modResults,\n    });\n    return config;\n  });\n};\n\nexport function getLocales(\n  config: Pick<ExpoConfig, 'locales'>\n): Record<string, string | LocaleJson> | null {\n  return config.locales ?? null;\n}\n\nexport async function setLocalesAsync(\n  config: Pick<ExpoConfig, 'locales'>,\n  { projectRoot, project }: { projectRoot: string; project: XcodeProject }\n): Promise<XcodeProject> {\n  const locales = getLocales(config);\n  if (!locales) {\n    return project;\n  }\n  // possibly validate CFBundleAllowMixedLocalizations is enabled\n  const localesMap = await getResolvedLocalesAsync(projectRoot, locales);\n\n  const projectName = getProjectName(projectRoot);\n  const supportingDirectory = join(projectRoot, 'ios', projectName, 'Supporting');\n\n  // TODO: Should we delete all before running? Revisit after we land on a lock file.\n  const stringName = 'InfoPlist.strings';\n\n  for (const [lang, localizationObj] of Object.entries(localesMap)) {\n    const dir = join(supportingDirectory, `${lang}.lproj`);\n    // await fs.ensureDir(dir);\n    await fs.promises.mkdir(dir, { recursive: true });\n\n    const strings = join(dir, stringName);\n    const buffer = [];\n    for (const [plistKey, localVersion] of Object.entries(localizationObj)) {\n      buffer.push(`${plistKey} = \"${localVersion}\";`);\n    }\n    // Write the file to the file system.\n    await fs.promises.writeFile(strings, buffer.join('\\n'));\n\n    const groupName = `${projectName}/Supporting/${lang}.lproj`;\n    // deep find the correct folder\n    const group = ensureGroupRecursively(project, groupName);\n\n    // Ensure the file doesn't already exist\n    if (!group?.children.some(({ comment }) => comment === stringName)) {\n      // Only write the file if it doesn't already exist.\n      project = addResourceFileToGroup({\n        filepath: relative(supportingDirectory, strings),\n        groupName,\n        project,\n        isBuildFile: true,\n        verbose: true,\n      });\n    }\n  }\n\n  return project;\n}\n\nexport async function getResolvedLocalesAsync(\n  projectRoot: string,\n  input: ExpoConfigLocales\n): Promise<ResolvedLocalesJson> {\n  const locales: ResolvedLocalesJson = {};\n  for (const [lang, localeJsonPath] of Object.entries(input)) {\n    if (typeof localeJsonPath === 'string') {\n      try {\n        locales[lang] = await JsonFile.readAsync(join(projectRoot, localeJsonPath));\n      } catch (e) {\n        // Add a warning when a json file cannot be parsed.\n        addWarningIOS(\n          `locales.${lang}`,\n          `Failed to parse JSON of locale file for language: ${lang}`,\n          'https://docs.expo.dev/distribution/app-stores/#localizing-your-ios-app'\n        );\n      }\n    } else {\n      // In the off chance that someone defined the locales json in the config, pass it directly to the object.\n      // We do this to make the types more elegant.\n      locales[lang] = localeJsonPath;\n    }\n  }\n\n  return locales;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}