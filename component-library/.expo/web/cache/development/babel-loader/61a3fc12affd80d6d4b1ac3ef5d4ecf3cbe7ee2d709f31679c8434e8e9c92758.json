{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar chalk_1 = __importDefault(require(\"chalk\"));\nvar expo_pwa_1 = require(\"expo-pwa\");\nvar webpack_1 = require(\"webpack\");\nvar ModifyHtmlWebpackPlugin_1 = __importDefault(require(\"./ModifyHtmlWebpackPlugin\"));\nvar ApplePwaWebpackPlugin = function (_ModifyHtmlWebpackPlu) {\n  _inherits(ApplePwaWebpackPlugin, _ModifyHtmlWebpackPlu);\n  var _super = _createSuper(ApplePwaWebpackPlugin);\n  function ApplePwaWebpackPlugin(pwaOptions, meta, icon, startupImage) {\n    var _this;\n    _classCallCheck(this, ApplePwaWebpackPlugin);\n    _this = _super.call(this);\n    _this.pwaOptions = pwaOptions;\n    _this.meta = meta;\n    _this.icon = icon;\n    _this.startupImage = startupImage;\n    return _this;\n  }\n  _createClass(ApplePwaWebpackPlugin, [{\n    key: \"modifyAsync\",\n    value: function () {\n      var _modifyAsync = _asyncToGenerator(function* (compiler, compilation, data) {\n        var _this2 = this;\n        var _a, _b;\n        var hasMetaTagWithName = function hasMetaTagWithName(name) {\n          return _this2.pwaOptions.meta.some(function (v) {\n            return v.name === name;\n          });\n        };\n        if (this.meta.isWebAppCapable) {\n          if (!hasMetaTagWithName('mobile-web-app-capable')) {\n            data.assetTags.meta.push(metaTag('mobile-web-app-capable', 'yes'));\n          }\n          if (!hasMetaTagWithName('apple-mobile-web-app-capable')) {\n            data.assetTags.meta.push(metaTag('apple-mobile-web-app-capable', 'yes'));\n          }\n        }\n        if (this.meta.isFullScreen && !hasMetaTagWithName('apple-touch-fullscreen')) {\n          data.assetTags.meta.push(metaTag('apple-touch-fullscreen', 'yes'));\n        }\n        if (this.meta.name && !hasMetaTagWithName('apple-mobile-web-app-title')) {\n          data.assetTags.meta.push(metaTag('apple-mobile-web-app-title', this.meta.name));\n        }\n        if (this.meta.barStyle && !hasMetaTagWithName('apple-mobile-web-app-status-bar-style')) {\n          data.assetTags.meta.push(metaTag('apple-mobile-web-app-status-bar-style', this.meta.barStyle));\n        }\n        var logger = compiler.getInfrastructureLogger('apple-pwa-plugin');\n        function logNotice(type, message) {\n          logger.log(chalk_1.default.magenta(\"\\u203A \" + type + \": \" + chalk_1.default.gray(message)));\n        }\n        function logWarning(type, message) {\n          logger.warn(chalk_1.default.yellow(\"\\u203A \" + type + \": \" + chalk_1.default.gray(message)));\n        }\n        if (this.icon) {\n          var links = this.pwaOptions.links.filter(function (v) {\n            return v.rel === 'apple-touch-icon';\n          }).map(function (v) {\n            return v.sizes;\n          });\n          var targetSizes = [180];\n          var requiredSizes = [];\n          for (var size of targetSizes) {\n            var sizes = size + \"x\" + size;\n            if (links.includes(sizes)) {\n              logNotice('Safari Icons', \"Using custom <link rel=\\\"apple-touch-icon\\\" sizes=\\\"\" + sizes + \"\\\" .../>\");\n            } else {\n              requiredSizes.push(size);\n            }\n          }\n          var iconAssets = yield (0, expo_pwa_1.generateAppleIconAsync)(this.pwaOptions, this.icon, {\n            sizes: requiredSizes\n          });\n          for (var asset of iconAssets) {\n            var _size = (_a = asset.tag) === null || _a === void 0 ? void 0 : _a.attributes.sizes;\n            if (_size && links.includes(_size)) {\n              logNotice('Safari Icons', \"Using custom <link rel=\\\"apple-touch-icon\\\" sizes=\\\"\" + _size + \"\\\" .../>\");\n            } else {\n              compilation.emitAsset(asset.asset.path, new webpack_1.sources.RawSource(asset.asset.source));\n              data.assetTags.meta.push(asset.tag);\n            }\n          }\n        } else {\n          logWarning('Safari Icons', \"No template image found, skipping auto generation...\");\n        }\n        if (this.startupImage) {\n          var assets = yield (0, expo_pwa_1.generateSplashAsync)(this.pwaOptions, this.startupImage);\n          var _links = this.pwaOptions.links.filter(function (v) {\n            return v.rel === 'apple-touch-startup-image';\n          }).map(function (v) {\n            return v.media;\n          });\n          for (var _asset of assets) {\n            var media = (_b = _asset.tag) === null || _b === void 0 ? void 0 : _b.attributes.media;\n            if (media && _links.includes(media)) {\n              logNotice('Safari Splash Screens', \"Using custom <link rel=\\\"apple-touch-startup-image\\\" media=\\\"\" + media + \"\\\" ... />\");\n            } else {\n              compilation.emitAsset(_asset.asset.path, new webpack_1.sources.RawSource(_asset.asset.source));\n              data.assetTags.meta.push(_asset.tag);\n            }\n          }\n        } else {\n          logWarning('Safari Splash Screens', \"No template image found, skipping auto generation...\");\n        }\n        return data;\n      });\n      function modifyAsync(_x, _x2, _x3) {\n        return _modifyAsync.apply(this, arguments);\n      }\n      return modifyAsync;\n    }()\n  }]);\n  return ApplePwaWebpackPlugin;\n}(ModifyHtmlWebpackPlugin_1.default);\nexports.default = ApplePwaWebpackPlugin;\nfunction metaTag(name, content) {\n  return {\n    tagName: 'meta',\n    voidTag: true,\n    attributes: {\n      name: name,\n      content: content\n    }\n  };\n}","map":{"version":3,"names":["chalk_1","__importDefault","require","expo_pwa_1","webpack_1","ModifyHtmlWebpackPlugin_1","ApplePwaWebpackPlugin","_ModifyHtmlWebpackPlu","_inherits","_super","_createSuper","pwaOptions","meta","icon","startupImage","_this","_classCallCheck","call","_createClass","key","value","_modifyAsync","_asyncToGenerator","compiler","compilation","data","_this2","hasMetaTagWithName","name","some","v","isWebAppCapable","assetTags","push","metaTag","isFullScreen","barStyle","logger","getInfrastructureLogger","logNotice","type","message","log","default","magenta","gray","logWarning","warn","yellow","links","filter","rel","map","sizes","targetSizes","requiredSizes","size","includes","iconAssets","generateAppleIconAsync","asset","_a","tag","attributes","emitAsset","path","sources","RawSource","source","assets","generateSplashAsync","media","_b","modifyAsync","_x","_x2","_x3","apply","arguments","exports","content","tagName","voidTag"],"sources":["/Users/henriqueeidt/Documents/Projects/poc-web-mobile-components/component-library/node_modules/@expo/webpack-config/src/plugins/ApplePwaWebpackPlugin.ts"],"sourcesContent":["import chalk from 'chalk';\nimport { generateAppleIconAsync, generateSplashAsync, IconOptions, ProjectOptions } from 'expo-pwa';\nimport { Compilation, Compiler, sources } from 'webpack';\n\nimport ModifyHtmlWebpackPlugin, { HTMLLinkNode, HTMLPluginData } from './ModifyHtmlWebpackPlugin';\n\nexport type ApplePwaMeta = {\n  name?: string;\n  barStyle?: string;\n  isWebAppCapable?: boolean;\n  isFullScreen?: boolean;\n};\n\nexport default class ApplePwaWebpackPlugin extends ModifyHtmlWebpackPlugin {\n  constructor(\n    private pwaOptions: ProjectOptions & { links: HTMLLinkNode[]; meta: HTMLLinkNode[] },\n    private meta: ApplePwaMeta,\n    private icon: IconOptions | null,\n    private startupImage: IconOptions | null\n  ) {\n    super();\n  }\n\n  async modifyAsync(\n    compiler: Compiler,\n    compilation: Compilation,\n    data: HTMLPluginData\n  ): Promise<HTMLPluginData> {\n    // Meta\n\n    const hasMetaTagWithName = (name: string): boolean => {\n      return this.pwaOptions.meta.some(v => v.name === name);\n    };\n\n    if (this.meta.isWebAppCapable) {\n      if (!hasMetaTagWithName('mobile-web-app-capable')) {\n        data.assetTags.meta.push(metaTag('mobile-web-app-capable', 'yes'));\n      }\n      if (!hasMetaTagWithName('apple-mobile-web-app-capable')) {\n        data.assetTags.meta.push(metaTag('apple-mobile-web-app-capable', 'yes'));\n      }\n    }\n    if (this.meta.isFullScreen && !hasMetaTagWithName('apple-touch-fullscreen')) {\n      data.assetTags.meta.push(metaTag('apple-touch-fullscreen', 'yes'));\n    }\n    if (this.meta.name && !hasMetaTagWithName('apple-mobile-web-app-title')) {\n      data.assetTags.meta.push(metaTag('apple-mobile-web-app-title', this.meta.name));\n    }\n    if (this.meta.barStyle && !hasMetaTagWithName('apple-mobile-web-app-status-bar-style')) {\n      data.assetTags.meta.push(\n        metaTag('apple-mobile-web-app-status-bar-style', this.meta.barStyle)\n      );\n    }\n\n    const logger = compiler.getInfrastructureLogger('apple-pwa-plugin');\n\n    function logNotice(type: string, message: string) {\n      logger.log(chalk.magenta(`\\u203A ${type}: ${chalk.gray(message)}`));\n    }\n\n    function logWarning(type: string, message: string) {\n      logger.warn(chalk.yellow(`\\u203A ${type}: ${chalk.gray(message)}`));\n    }\n    // App Icon\n    if (this.icon) {\n      const links: string[] = this.pwaOptions.links\n        .filter(v => v.rel === 'apple-touch-icon')\n        .map(v => v.sizes!);\n\n      const targetSizes = [180];\n      const requiredSizes: number[] = [];\n\n      for (const size of targetSizes) {\n        const sizes = `${size}x${size}`;\n        if (links.includes(sizes)) {\n          logNotice(\n            'Safari Icons',\n            `Using custom <link rel=\"apple-touch-icon\" sizes=\"${sizes}\" .../>`\n          );\n        } else {\n          requiredSizes.push(size);\n        }\n      }\n\n      const iconAssets = await generateAppleIconAsync(this.pwaOptions, this.icon, {\n        sizes: requiredSizes,\n      });\n\n      for (const asset of iconAssets) {\n        const size = asset.tag?.attributes.sizes;\n        if (size && links.includes(size)) {\n          logNotice(\n            'Safari Icons',\n            `Using custom <link rel=\"apple-touch-icon\" sizes=\"${size}\" .../>`\n          );\n        } else {\n          compilation.emitAsset(asset.asset.path, new sources.RawSource(asset.asset.source));\n          data.assetTags.meta.push(asset.tag);\n        }\n      }\n    } else {\n      logWarning('Safari Icons', `No template image found, skipping auto generation...`);\n    }\n\n    // Splash screens\n\n    if (this.startupImage) {\n      const assets = await generateSplashAsync(this.pwaOptions, this.startupImage);\n\n      const links: string[] = this.pwaOptions.links\n        .filter(v => v.rel === 'apple-touch-startup-image')\n        .map(v => v.media!);\n\n      for (const asset of assets) {\n        const media = asset.tag?.attributes.media;\n        if (media && links.includes(media)) {\n          logNotice(\n            'Safari Splash Screens',\n            `Using custom <link rel=\"apple-touch-startup-image\" media=\"${media}\" ... />`\n          );\n        } else {\n          compilation.emitAsset(asset.asset.path, new sources.RawSource(asset.asset.source));\n          data.assetTags.meta.push(asset.tag);\n        }\n      }\n    } else {\n      logWarning('Safari Splash Screens', `No template image found, skipping auto generation...`);\n    }\n    return data;\n  }\n}\n\nfunction metaTag(name: string, content: string): any {\n  return {\n    tagName: 'meta',\n    voidTag: true,\n    attributes: {\n      name,\n      content,\n    },\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}